---
// åŠ¨æ€è®¡ç®—å½“å‰å‘¨è®°åå’Œæ—¥è®°åçš„ç»„ä»¶
// åŸºäº ISO 8601 æ ‡å‡†è®¡ç®—å‘¨æ•°

interface Props {
	showWeekly?: boolean;
	showDaily?: boolean;
	className?: string;
}

const { showWeekly = true, showDaily = true, className = "" } = Astro.props;

// è®¡ç®— ISO 8601 å‘¨æ•°çš„å‡½æ•°
function getISOWeek(date: Date): {
	year: number;
	week: number;
	dayOfWeek: number;
} {
	// åˆ›å»ºæ—¥æœŸå‰¯æœ¬é¿å…ä¿®æ”¹åŸå§‹æ—¥æœŸ
	const target = new Date(date.valueOf());
	const dayNr = (date.getDay() + 6) % 7; // å‘¨ä¸€ä¸º0ï¼Œå‘¨æ—¥ä¸º6

	// è®¾ç½®åˆ°æœ¬å‘¨å››
	target.setDate(target.getDate() - dayNr + 3);
	const jan4 = new Date(target.getFullYear(), 0, 4);
	const dayDiff = (target.getTime() - jan4.getTime()) / 86400000;

	// è®¡ç®—å‘¨æ•°
	const weekNum =
		1 + Math.round((dayDiff - ((jan4.getDay() + 6) % 7) + 3) / 7);

	return {
		year: target.getFullYear(),
		week: weekNum,
		dayOfWeek: dayNr + 1, // 1-7ï¼Œå‘¨ä¸€ä¸º1ï¼Œå‘¨æ—¥ä¸º7
	};
}

// è·å–å½“å‰æ—¶é—´ä¿¡æ¯
const now = new Date();
const { year, week, dayOfWeek } = getISOWeek(now);

// ç”Ÿæˆå‘½å
const weeklyName = `${year} W${week}`;
const dailyName = `${year} W${week} D${dayOfWeek}`;
---

<div class={`naming-card ${className}`}>
	<div class="card-header">
		<div class="card-icon">ğŸ“…</div>
		<h3 class="card-title">å½“å‰å‘½å</h3>
	</div>
	<div class="card-content">
		{
			showWeekly && (
				<div class="naming-item weekly">
					<div class="item-icon">ğŸ“</div>
					<div class="item-content">
						<span class="item-label">å‘¨è®°</span>
						<span class="item-value">{weeklyName}</span>
					</div>
				</div>
			)
		}
		{
			showDaily && (
				<div class="naming-item daily">
					<div class="item-icon">ğŸ“–</div>
					<div class="item-content">
						<span class="item-label">æ—¥è®°</span>
						<span class="item-value">{dailyName}</span>
					</div>
				</div>
			)
		}
	</div>
</div>

<style>
	.naming-card {
		margin-bottom: 1.5rem;
		border-radius: 0.75rem;
		background: var(--color-global-bg);
		border: 1px solid
			color-mix(in srgb, var(--color-global-text) 15%, transparent);
		box-shadow: 0 1px 3px 0
			color-mix(in srgb, var(--color-global-text) 10%, transparent);
		overflow: hidden;
		transition: all 0.2s ease;
	}

	.naming-card:hover {
		box-shadow: 0 4px 12px 0
			color-mix(in srgb, var(--color-global-text) 15%, transparent);
		transform: translateY(-1px);
	}

	.card-header {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 1rem 1.25rem 0.75rem;
		background: linear-gradient(
			135deg,
			color-mix(in srgb, var(--color-accent) 8%, transparent),
			color-mix(in srgb, var(--color-accent) 4%, transparent)
		);
		border-bottom: 1px solid
			color-mix(in srgb, var(--color-global-text) 8%, transparent);
	}

	.card-icon {
		font-size: 1.25rem;
		line-height: 1;
	}

	.card-title {
		margin: 0;
		font-size: 1rem;
		font-weight: 600;
		color: var(--color-accent);
		letter-spacing: -0.025em;
	}

	.card-content {
		padding: 1rem 1.25rem 1.25rem;
	}

	.naming-item {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.75rem;
		border-radius: 0.5rem;
		background: color-mix(
			in srgb,
			var(--color-global-text) 3%,
			transparent
		);
		transition: background-color 0.15s ease;
	}

	.naming-item:not(:last-child) {
		margin-bottom: 0.75rem;
	}

	.naming-item:hover {
		background: color-mix(
			in srgb,
			var(--color-global-text) 6%,
			transparent
		);
	}

	.item-icon {
		font-size: 1.125rem;
		line-height: 1;
		opacity: 0.8;
	}

	.item-content {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		flex: 1;
	}

	.item-label {
		font-size: 0.75rem;
		font-weight: 500;
		color: color-mix(in srgb, var(--color-global-text) 60%, transparent);
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	.item-value {
		font-family:
			ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
			"Liberation Mono", "Courier New", monospace;
		font-weight: 700;
		font-size: 1.125rem;
		color: var(--color-accent);
		letter-spacing: 0.025em;
	}

	/* æ·±è‰²æ¨¡å¼é€‚é… */
	[data-theme="dark"] .naming-card {
		border-color: color-mix(
			in srgb,
			var(--color-global-text) 20%,
			transparent
		);
		box-shadow: 0 1px 3px 0
			color-mix(in srgb, var(--color-global-text) 20%, transparent);
	}

	[data-theme="dark"] .naming-card:hover {
		box-shadow: 0 4px 12px 0
			color-mix(in srgb, var(--color-global-text) 25%, transparent);
	}

	[data-theme="dark"] .card-header {
		background: linear-gradient(
			135deg,
			color-mix(in srgb, var(--color-accent) 12%, transparent),
			color-mix(in srgb, var(--color-accent) 6%, transparent)
		);
		border-bottom-color: color-mix(
			in srgb,
			var(--color-global-text) 15%,
			transparent
		);
	}

	[data-theme="dark"] .naming-item {
		background: color-mix(
			in srgb,
			var(--color-global-text) 6%,
			transparent
		);
	}

	[data-theme="dark"] .naming-item:hover {
		background: color-mix(
			in srgb,
			var(--color-global-text) 10%,
			transparent
		);
	}

	/* å“åº”å¼è®¾è®¡ */
	@media (min-width: 640px) {
		.card-content {
			display: flex;
			gap: 1rem;
		}

		.naming-item {
			flex: 1;
			margin-bottom: 0;
		}

		.naming-item:not(:last-child) {
			margin-bottom: 0;
		}
	}
</style>
