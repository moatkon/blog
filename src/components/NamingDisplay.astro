---
// åŠ¨æ€è®¡ç®—å½“å‰å‘¨è®°åå’Œæ—¥è®°åçš„ç»„ä»¶
// åŸºäº ISO 8601 æ ‡å‡†è®¡ç®—å‘¨æ•°

interface Props {
	showWeekly?: boolean;
	showDaily?: boolean;
	className?: string;
}

const { showWeekly = true, showDaily = true, className = "" } = Astro.props;

// è¿™é‡Œä¸å†è¿›è¡ŒæœåŠ¡ç«¯è®¡ç®—ï¼Œæ”¹ä¸ºå®¢æˆ·ç«¯åŠ¨æ€è®¡ç®—
---

<naming-display
	class={`naming-card ${className}`}
	data-show-weekly={showWeekly}
	data-show-daily={showDaily}
>
	<div class="card-header">
		<div class="card-icon">ğŸ“…</div>
		<h3 class="card-title">å½“å‰å‘½å</h3>
	</div>
	<div class="card-content">
		{
			showWeekly && (
				<div class="naming-item weekly">
					<div class="item-icon">ğŸ“</div>
					<div class="item-content">
						<span class="item-label">å‘¨è®°</span>
						<span class="item-value weekly-name">åŠ è½½ä¸­...</span>
					</div>
				</div>
			)
		}
		{
			showDaily && (
				<div class="naming-item daily">
					<div class="item-icon">ğŸ“–</div>
					<div class="item-content">
						<span class="item-label">æ—¥è®°</span>
						<span class="item-value daily-name">åŠ è½½ä¸­...</span>
					</div>
				</div>
			)
		}
	</div>
</naming-display>

<style>
	naming-display {
		display: block;
	}

	.naming-card {
		margin-bottom: 1.5rem;
		border-radius: 0.75rem;
		background: var(--color-global-bg);
		border: 1px solid
			color-mix(in srgb, var(--color-global-text) 15%, transparent);
		box-shadow: 0 1px 3px 0
			color-mix(in srgb, var(--color-global-text) 10%, transparent);
		overflow: hidden;
		transition: all 0.2s ease;
	}

	.naming-card:hover {
		box-shadow: 0 4px 12px 0
			color-mix(in srgb, var(--color-global-text) 15%, transparent);
		transform: translateY(-1px);
	}

	.card-header {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 1rem 1.25rem 0.75rem;
		background: linear-gradient(
			135deg,
			color-mix(in srgb, var(--color-accent) 8%, transparent),
			color-mix(in srgb, var(--color-accent) 4%, transparent)
		);
		border-bottom: 1px solid
			color-mix(in srgb, var(--color-global-text) 8%, transparent);
	}

	.card-icon {
		font-size: 1.25rem;
		line-height: 1;
	}

	.card-title {
		margin: 0;
		font-size: 1rem;
		font-weight: 600;
		color: var(--color-accent);
		letter-spacing: -0.025em;
	}

	.card-content {
		padding: 1rem 1.25rem 1.25rem;
	}

	.naming-item {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.75rem;
		border-radius: 0.5rem;
		background: color-mix(
			in srgb,
			var(--color-global-text) 3%,
			transparent
		);
		transition: background-color 0.15s ease;
	}

	.naming-item:not(:last-child) {
		margin-bottom: 0.75rem;
	}

	.naming-item:hover {
		background: color-mix(
			in srgb,
			var(--color-global-text) 6%,
			transparent
		);
	}

	.item-icon {
		font-size: 1.125rem;
		line-height: 1;
		opacity: 0.8;
	}

	.item-content {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		flex: 1;
	}

	.item-label {
		font-size: 0.75rem;
		font-weight: 500;
		color: color-mix(in srgb, var(--color-global-text) 60%, transparent);
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	.item-value {
		font-family:
			ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
			"Liberation Mono", "Courier New", monospace;
		font-weight: 700;
		font-size: 1.125rem;
		color: var(--color-accent);
		letter-spacing: 0.025em;
	}

	/* æ·±è‰²æ¨¡å¼é€‚é… */
	[data-theme="dark"] .naming-card {
		border-color: color-mix(
			in srgb,
			var(--color-global-text) 20%,
			transparent
		);
		box-shadow: 0 1px 3px 0
			color-mix(in srgb, var(--color-global-text) 20%, transparent);
	}

	[data-theme="dark"] .naming-card:hover {
		box-shadow: 0 4px 12px 0
			color-mix(in srgb, var(--color-global-text) 25%, transparent);
	}

	[data-theme="dark"] .card-header {
		background: linear-gradient(
			135deg,
			color-mix(in srgb, var(--color-accent) 12%, transparent),
			color-mix(in srgb, var(--color-accent) 6%, transparent)
		);
		border-bottom-color: color-mix(
			in srgb,
			var(--color-global-text) 15%,
			transparent
		);
	}

	[data-theme="dark"] .naming-item {
		background: color-mix(
			in srgb,
			var(--color-global-text) 6%,
			transparent
		);
	}

	[data-theme="dark"] .naming-item:hover {
		background: color-mix(
			in srgb,
			var(--color-global-text) 10%,
			transparent
		);
	}

	/* å“åº”å¼è®¾è®¡ */
	@media (min-width: 640px) {
		.card-content {
			display: flex;
			gap: 1rem;
		}

		.naming-item {
			flex: 1;
			margin-bottom: 0;
		}

		.naming-item:not(:last-child) {
			margin-bottom: 0;
		}
	}
</style>

<script>
	// å®¢æˆ·ç«¯åŠ¨æ€è®¡ç®—å‘¨æ•°å’Œæ—¥æœŸ
	class NamingDisplay extends HTMLElement {
		connectedCallback() {
			this.updateNaming();
		}

		// ä¿®æ­£çš„ ISO 8601 å‘¨æ•°è®¡ç®—ï¼Œä¸Googleæ—¥å†åŒ¹é…
		getISOWeek(date: Date): {
			year: number;
			week: number;
			dayOfWeek: number;
		} {
			const target = new Date(date.valueOf());

			// è·å–æ˜ŸæœŸå‡  (0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­)
			const dayOfWeek = target.getDay();
			// è½¬æ¢ä¸º ISO æ ¼å¼ (1=å‘¨ä¸€, 2=å‘¨äºŒ, ..., 7=å‘¨æ—¥)
			const isoDayOfWeek = dayOfWeek === 0 ? 7 : dayOfWeek;

			// å¤åˆ¶æ—¥æœŸå¹¶è°ƒæ•´åˆ°æœ¬å‘¨çš„å‘¨å››
			const thursday = new Date(target);
			thursday.setDate(target.getDate() + (4 - isoDayOfWeek));

			// è·å–å‘¨å››æ‰€åœ¨çš„å¹´ä»½
			const year = thursday.getFullYear();

			// è®¡ç®—è¯¥å¹´1æœˆ4æ—¥ï¼ˆISO 8601æ ‡å‡†ä¸­ç¬¬1å‘¨æ€»æ˜¯åŒ…å«1æœˆ4æ—¥ï¼‰
			const jan4 = new Date(year, 0, 4);

			// æ‰¾åˆ°1æœˆ4æ—¥æ‰€åœ¨å‘¨çš„å‘¨ä¸€
			const jan4DayOfWeek = jan4.getDay();
			const jan4Monday = new Date(jan4);
			jan4Monday.setDate(
				4 - (jan4DayOfWeek === 0 ? 7 : jan4DayOfWeek) + 1,
			);

			// è®¡ç®—å‘¨æ•°
			const weekNumber =
				Math.floor(
					(thursday.getTime() - jan4Monday.getTime()) /
						(7 * 24 * 60 * 60 * 1000),
				) + 1;

			return {
				year: year,
				week: weekNumber,
				dayOfWeek: isoDayOfWeek,
			};
		}

		updateNaming() {
			const now = new Date();
			const { year, week, dayOfWeek } = this.getISOWeek(now);

			const weeklyName = `${year} W${week}`;
			const dailyName = `${year} W${week} D${dayOfWeek}`;

			// æ›´æ–°æ˜¾ç¤º
			const weeklyElement = this.querySelector(".weekly-name");
			const dailyElement = this.querySelector(".daily-name");

			if (weeklyElement) {
				weeklyElement.textContent = weeklyName;
			}

			if (dailyElement) {
				dailyElement.textContent = dailyName;
			}
		}
	}

	customElements.define("naming-display", NamingDisplay);
</script>
